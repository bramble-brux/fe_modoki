# 作業管理タイマー 要件定義書 - v2.1

## 1. 概要

[「１５分チェンジ法」](https://ixy.blog.jp/archives/2366349.html)に基づき、集中力を最大化する iOS タイマーアプリ。
仕事（Work）と休憩（Free）を交互に繰り返し、作業のハードルを下げつつ深い集中（フロー）を目指す。

### 1.1 基本思想

- **Work の延長は「良いこと」**: 作業にノっている状態（フロー）であり、無理に止める必要はない。超過時間は明るい緑色で表示し、成果として可視化する。
- **Free の延長は「厳禁」**: 休憩の延長は集中サイクルを崩壊させる。目標到達で即座にアラートを鳴らし、1分ごとに通知で催促する。タイマーは 0:00 で停止し、赤色で警告表示にする。
- **15分はあくまで目安**: 設定画面で自由にカスタマイズ可能だが、元メソッドでは15分が推奨されている。

## 2. 画面構成

アプリは以下の4画面＋2シートで構成される。

| 画面 | 概要 |
|------|------|
| 開始画面 | Work/Free の開始、カレンダー・設定へのアクセス |
| タイマー画面 | カウントダウン/カウントアップ、モード切替、一時停止、終了 |
| 完了画面 | セッション結果（Work 合計時間）の表示 |
| カレンダー画面 | 月間統計チャート＋ Work 履歴リスト |
| 設定シート | Work/Free の目標時間、通知のON/OFF |

## 3. 画面別仕様

### 3.1 開始画面

- 装飾なし。シンプルなポータル。
- **Work スタート** ボタン（ダンベルアイコン、ワインレッド背景）
- **Free スタート** ボタン（コントローラーアイコン、ミッドナイトブルー背景）
- **カレンダー** ボタン（カレンダーアイコン）
- **設定** ボタン（歯車アイコン）

### 3.2 タイマー画面

#### 共通
- 画面上部: モードアイコン＋モード名
- 画面中央: タイマー表示（MM:SS or H:MM:SS）
- 画面下部: 操作ボタン群

#### 仕事モード（Work）
| 状態 | 背景色 | タイマー色 | 計測方式 | 操作 |
|------|--------|-----------|----------|------|
| カウントダウン中 | ワインレッド | 白 | 目標時間から減算 | Free へ(大), 一時停止(小), 終了(小) |
| 超過（カウントアップ） | ワインレッド | 明るい緑 | 0:00 からの加算 | Free へ(大), 一時停止(小), 終了(小) |
| 一時停止中 | ワインレッド | 白/緑 | 停止 | Free へ(大), 再開(小), 終了(小) |

- 超過時に「(超過)」等のラベルは表示しない。色の変化で判別する。
- **超過はフロー状態の証。** ユーザーが自発的に切り替えるまで制限しない。
- **ボタンレイアウトは一時停止/再開の切替時に変動しないこと。**

#### 自由モード（Free）
| 状態 | 背景色 | タイマー色 | 計測方式 | 操作 |
|------|--------|-----------|----------|------|
| カウントダウン中 | ミッドナイトブルー | 白 | 目標時間から減算 | Work へ(大), 一時停止(小), 終了(小) |
| 超過（0:00 停止） | ミッドナイトブルー | 赤 | 0:00 で停止 | Work へ(大), 終了(小) |

- Free 超過時、一時停止ボタンは非表示だが **レイアウトスペースは維持** する。
- **Free の延長は厳禁。** アラートと通知で速やかな Work 復帰を促す。

### 3.3 完了画面

- 「お疲れ様でした」メッセージ
- 今回のセッションの **Work 合計時間** を表示
- 「スタートに戻る」ボタン

### 3.4 カレンダー画面

- タイトル: 「カレンダー」
- **月間統計セクション**: 今月の Work 合計時間＋日別棒グラフ（Y軸: 分）
- **Work 履歴セクション**: Work 記録のみ表示（Free は非表示）
  - 各レコード: 日付、時刻、所要時間、メモ欄
  - 削除: スワイプ削除、編集モード対応（アイコンボタン）
  - メモ: テキストフィールドで直接入力
- 閉じるボタン: ✕ アイコン（開始画面に戻る）
- 最大保存件数: 100件

### 3.5 設定シート

- 全て日本語表記
- Work 目標時間（分・秒）
- Free 目標時間（分・秒）
- Work 目標達成時に通知（ON/OFF トグル）
- 「完了」ボタンで閉じる

## 4. データモデル

### SessionRecord
| フィールド | 型 | 説明 |
|-----------|------|------|
| id | UUID | 一意識別子 |
| date | Date | 記録日時 |
| mode | TimerMode | 常に `.work` で保存 |
| durationSeconds | Int | セッション中の Work 合計秒数 |
| notes | String | ユーザーメモ（初期値: 空文字） |

### 記録タイミング
- **「終了」ボタン押下時** にセッション中の Work 時間の合計を1レコードとして保存する。
- モード切替時（Free へ / Work へ）には保存しない（sessionWorkSeconds に累積のみ）。

## 5. 通知仕様

| イベント | タイトル | 本文 |
|---------|--------|------|
| Work 目標達成 | work終了です、お疲れ様でした | （空） |
| Free 超過開始 | workの時間です | free時間を超過しています。 |
| Free 超過中（1分ごと） | workの時間です | free時間を{N}分超過しています。 |
| バックグラウンド予約（Work） | work終了です、お疲れ様でした | （空） |
| バックグラウンド予約（Free） | workの時間です | free時間を超過しています。 |

- Work 目標達成通知は **1回だけ**（設定 ON 時）。
- Free 超過通知はアラート音と共に **1分間隔で繰り返し**。
- ロック画面から「STOP / 次へ」アクションでモード切替可能。

## 6. バックグラウンド対応

- バックグラウンド移行時に `backgroundDate` を記録。
- フォアグラウンド復帰時に差分を `elapsed` に加算してキャッチアップ。
- **一時停止中はキャッチアップしない。**
- バックグラウンド通知は復帰時にキャンセル（ID: `TIMER_ALERT_BG`）。

## 7. デザイン定数

| 定数 | 値 | 用途 |
|------|-----|------|
| ワインレッド | `#722F37` | Work 背景色 |
| ミッドナイトブルー | `#191970` | Free 背景色 |
| Success | `.green` | Work 超過時タイマー文字色 |
| Warning | `.red` | Free 超過時タイマー文字色 |

## 8. 非機能要件

- **プラットフォーム**: iOS 17.0+ (SwiftUI)
- **フレームワーク**: SwiftUI, Charts, UserNotifications, AudioToolbox
- **永続化**: AppStorage + JSON エンコーディング
- **アプリアイコン**: 目覚まし時計の中央に「15」の文字
